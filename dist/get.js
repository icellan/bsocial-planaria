"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));Object.defineProperty(exports,"__esModule",{value:!0}),exports.getBitbusStreamingEvents=exports.getBitbusBlockEvents=void 0;require("node-fetch");var _eventStream=_interopRequireDefault(require("event-stream")),_config=require("./config"),getBitbusBlockEvents=function(){var a=(0,_asyncToGenerator2.default)(function*(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"bob";b="txo"===b?"txo":"bob";var c=yield fetch("https://".concat(b,".bitbus.network/block"),{method:"post",headers:{"Content-type":"application/json; charset=utf-8",token:_config.TOKEN,format:"json"},body:JSON.stringify(a)});return c.json()});return function(){return a.apply(this,arguments)}}();exports.getBitbusBlockEvents=getBitbusBlockEvents;var getBitbusStreamingEvents=(a,b,c)=>new Promise(d=>{a.q.find["blk.i"]={$gt:b},fetch("https://bob.bitbus.network/block",{method:"post",headers:{"Content-type":"application/json; charset=utf-8",token:_config.TOKEN},body:JSON.stringify(a)}).then(function(){var a=(0,_asyncToGenerator2.default)(function*(a){a.body.on("end",()=>{d()}).pipe(_eventStream.default.split()).pipe(_eventStream.default.mapSync(function(){var b=(0,_asyncToGenerator2.default)(function*(b){if(a.body.pause(),b){var d=JSON.parse(b);yield c(d)}a.body.resume()});return function(){return b.apply(this,arguments)}}()))});return function(){return a.apply(this,arguments)}}())});exports.getBitbusStreamingEvents=getBitbusStreamingEvents;