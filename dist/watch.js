"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.watchBSocialTransactions=void 0;var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_reconnectingEventsource=_interopRequireDefault(require("./lib/reconnecting-eventsource")),_bsocial=require("./bsocial.js"),watchBSocialTransactions=function(){var a=(0,_asyncToGenerator2.default)(function*(){var a=!!(0<arguments.length&&arguments[0]!==void 0)&&arguments[0],b=(0,_bsocial.getBitsocketQuery)(!1,a),c=Buffer.from(JSON.stringify(b)).toString("base64"),d="https://bob.bitsocket.network/s/".concat(c);console.log("starting socket listener on",d);var e=new _reconnectingEventsource.default(d);e.onmessage=function(){var a=(0,_asyncToGenerator2.default)(function*(a){var b=JSON.parse(a.data).data;b&&0<b.length&&b.forEach(a=>{(0,_bsocial.processBlockEvents)(a)})});return function(){return a.apply(this,arguments)}}(),yield(0,_bsocial.indexBSocialTransactions)(),setInterval((0,_asyncToGenerator2.default)(function*(){yield(0,_bsocial.indexBSocialTransactions)()}),300000)});return function(){return a.apply(this,arguments)}}();exports.watchBSocialTransactions=watchBSocialTransactions;