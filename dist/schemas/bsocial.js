"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.BSOCIAL=void 0;var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_simplSchema=_interopRequireDefault(require("simpl-schema")),_collection=require("../lib/collection"),_bsocialAfterInsert=require("./hooks/bsocial-after-insert"),BObject=new _simplSchema.default({content:{type:String,optional:!0},length:{type:Number,optional:!0},url:{type:String,optional:!0},"content-type":{type:String,optional:!0},encoding:{type:String,optional:!0},filename:{type:String,optional:!0}}),BPPObject=new _simplSchema.default({action:{type:String,optional:!1},currency:{type:String,optional:!1},address:{type:String,optional:!1},apiEndpoint:{type:String,optional:!0}}),AIPObject=new _simplSchema.default({algorithm:{type:String,optional:!1},address:{type:String,optional:!1},bapId:{type:String,optional:!0},signature:{type:String,optional:!1},index:{type:Array,optional:!0},"index.$":{type:Number},verified:{type:Boolean,optional:!1}}),BSOCIAL=new _collection.Collection("bsocial",new _simplSchema.default({block:{type:_simplSchema.default.Integer,label:"Block number this transaction was mined into - null if still in mempool",optional:!0},timestamp:{type:_simplSchema.default.Integer,label:"Timestamp this transaction was mined - null if still in mempool",optional:!0},B:{type:Array,optional:!0},"B.$":{type:BObject},MAP:{type:Array,optional:!1},"MAP.$":{type:Object,blackbox:!0},AIP:{type:Array,optional:!0},"AIP.$":{type:AIPObject},BPP:{type:Array,optional:!0},"BPP.$":{type:BPPObject},likes:{type:_simplSchema.default.Integer,optional:!0},reposts:{type:_simplSchema.default.Integer,optional:!0},comments:{type:_simplSchema.default.Integer,optional:!0},tips:{type:_simplSchema.default.Integer,optional:!0},payments:{type:_simplSchema.default.Integer,optional:!0},processed:{type:Boolean,optional:!0}}));exports.BSOCIAL=BSOCIAL,BSOCIAL.after("insert",function(){var a=(0,_asyncToGenerator2.default)(function*(a){yield(0,_bsocialAfterInsert.bSocialAfterInsert)(a),yield BSOCIAL.updateOne({_id:a._id},{$set:{processed:!0}}).catch(a=>{console.error("Failed updating BSocial processed",a.reason||a.message)})});return function(){return a.apply(this,arguments)}}());